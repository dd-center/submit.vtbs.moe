(function(t){function e(e){for(var i,r,o=e[0],l=e[1],c=e[2],d=0,p=[];d<o.length;d++)r=o[d],Object.prototype.hasOwnProperty.call(a,r)&&a[r]&&p.push(a[r][0]),a[r]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(t[i]=l[i]);u&&u(e);while(p.length)p.shift()();return n.push.apply(n,c||[]),s()}function s(){for(var t,e=0;e<n.length;e++){for(var s=n[e],i=!0,o=1;o<s.length;o++){var l=s[o];0!==a[l]&&(i=!1)}i&&(n.splice(e--,1),t=r(r.s=s[0]))}return t}var i={},a={app:0},n=[];function r(e){if(i[e])return i[e].exports;var s=i[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=t,r.c=i,r.d=function(t,e,s){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(s,i,function(e){return t[e]}.bind(null,i));return s},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=e,o=o.slice();for(var c=0;c<o.length;c++)e(o[c]);var u=l;n.push([0,"chunk-vendors"]),s()})({0:function(t,e,s){t.exports=s("56d7")},"03f4":function(t,e,s){s("14d9"),t.exports=({vtbs:t})=>{const e=[],s=Object.fromEntries(t.map(t=>[t.uuid,t]));return t.forEach(({group:t,name:i})=>{t&&!s[t]&&e.push("社团不存在, no group "+i[i.default])}),e}},"0640":function(t,e,s){"use strict";s.d(e,"b",(function(){return d})),s.d(e,"a",(function(){return p})),s.d(e,"c",(function(){return f}));s("14d9");var i=s("faa1"),a=s.n(i);const n=!self.window;let r;const o=[],l=new Map,c=new Map,u=()=>String(Math.random()),d=new a.a,p=t=>{if(r)throw new Error("Worker??");r=t,t.addEventListener("message",({data:{key:t,data:e}})=>{l.get(t)(e),l.delete(t),c.delete(t),d.emit("running",[...c.entries()])})};n&&self.addEventListener("message",async({data:{fNum:t,params:e,key:s}})=>{self.postMessage({key:s,data:await o[t](...e)})});const f=t=>{const e=o.length;o.push(t);const s=(...s)=>r?new Promise(i=>{if(r){const a=u();l.set(a,i),c.set(a,t.displayName),d.emit("c",[...c.entries()]),r.postMessage({fNum:e,params:s,key:a})}}):t(...s);return s.registerName=e=>{t.displayName=e},s}},"0e2e":function(t,e,s){},"197f":function(t,e,s){"use strict";s("ed54")},"23da":function(t,e,s){"use strict";s("f4ec")},3955:function(t,e){t.exports=({vtbs:t})=>t.flatMap(({accounts:t})=>t).map(({id:t})=>"string"!==typeof t&&"id is not string, "+t).filter(Boolean)},"3e55":function(t,e,s){const i=s("03f4"),a=s("9309"),n=s("b90b"),r=s("3955"),o=s("c754"),l=s("b74b"),c=s("6691"),u=s("9d6a"),d=s("cb76"),p=[i,a,r,n,o,l,c,u,d];t.exports=(t,e)=>p.flatMap(s=>s(t,e))},"4c53":function(t,e,s){t.exports=function(){return new Worker(s.p+"ee120c6a0ae616f2f327.worker.js")}},"51c0":function(t,e,s){},5598:function(t,e,s){"use strict";s("fd73")},"56d7":function(t,e,s){"use strict";s.r(e);var i=s("2b0e"),a=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[e("div",[e("section",{staticClass:"hero is-success is-fullheight is-bold"},[t._m(0),e("div",{staticClass:"hero-foot"},[t.fsLoaded?e("nav",{staticClass:"tabs"},[e("div",{staticClass:"container"},[e("ul",[e("router-link",{attrs:{to:"/",custom:""},scopedSlots:t._u([{key:"default",fn:function({navigate:s,href:i,isExactActive:a}){return[e("li",{staticClass:"link",class:{active:a}},[e("a",{staticClass:"aLink",attrs:{href:i},on:{click:s}},[t._v("Panel")])])]}}],null,!1,2085697681)}),e("router-link",{attrs:{to:"/edit",custom:""},scopedSlots:t._u([{key:"default",fn:function({navigate:s,href:i,isExactActive:a}){return[e("li",{staticClass:"link",class:{active:a}},[e("a",{staticClass:"aLink",attrs:{href:i},on:{click:s}},[t._v("新建")])])]}}],null,!1,107677613)}),e("router-link",{attrs:{to:"/submit",custom:""},scopedSlots:t._u([{key:"default",fn:function({navigate:s,href:i,isExactActive:a}){return[e("li",{staticClass:"link",class:{active:a}},[e("a",{staticClass:"aLink",attrs:{href:i},on:{click:s}},[t._v("提交!("+t._s(t.diff.length+t.issuesApply.length)+")")])])]}}],null,!1,3474384806)}),e("router-link",{attrs:{to:"/workspace",custom:""},scopedSlots:t._u([{key:"default",fn:function({navigate:s,href:i,isExactActive:a}){return[e("li",{staticClass:"link",class:{active:a}},[e("a",{staticClass:"aLink",attrs:{href:i},on:{click:s}},[t._v("工作区存档("+t._s(t.workspaceList.length)+")")])])]}}],null,!1,1043660902)}),e("router-link",{attrs:{to:"/issue",custom:""},scopedSlots:t._u([{key:"default",fn:function({navigate:s,href:i,isExactActive:a}){return[e("li",{staticClass:"link",class:{active:a}},[e("a",{staticClass:"aLink",attrs:{href:i},on:{click:s}},[t._v("issue ("+t._s(t.issuesApply.length)+"/"+t._s(Object.keys(t.issues).length)+")")])])]}}],null,!1,3113405594)}),e("router-link",{attrs:{to:"/login",custom:""},scopedSlots:t._u([{key:"default",fn:function({navigate:s,href:i,isExactActive:a}){return[e("li",{staticClass:"link",class:{active:a}},[e("a",{staticClass:"aLink",attrs:{href:i},on:{click:s}},[t._v("登录"+t._s(t.currentState))])])]}}],null,!1,3493054353)})],1)])]):e("div",{staticClass:"container"},[t._v(" Loading... ")])])]),t.fsLoaded?e("router-view"):t._e()],1),e("transition-group",{attrs:{name:"worker-list"}},t._l(t.running,(function([s,i],a){return e("span",{key:"worker_"+s,staticClass:"tag is-rounded running",style:{bottom:30*a+"px"}},[t._v(t._s(i))])})),0)],1)},n=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"hero-body"},[e("div",{staticClass:"container"},[e("h1",{staticClass:"title"},[t._v(" submit.vtbs.moe ")]),e("h2",{staticClass:"subtitle"},[t._v(" 你好呀 ")]),t._v(" 如何正确提交："),e("a",{attrs:{href:"https://docs.vtbs.top",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://docs.vtbs.top")]),e("br")])])}],r=s("2f62"),o=s("0640");s("88a7"),s("271a"),s("5494");const l="localhost"===location.hostname,c=l?"23b965c70f0005df2d72":"0dcef2f6e6221b70214f",u=l?"505afa12c4fda8164fb56e9f2b607f3e62f62de0":"e1d64c4471a750145616d38b22b063a380cd9a3a",d=()=>{const t=new URL("https://github.com/login/oauth/authorize");return t.searchParams.set("client_id",c),l&&t.searchParams.set("redirect_uri","http://localhost:8080/login"),t.searchParams.set("scope","public_repo"),t.toString()},p=async t=>{const e=await fetch("https://dd.center/api/proxy/access_token",{method:"POST",body:JSON.stringify({code:t,client_secret:u,client_id:c})}),{access_token:s}=await e.json();return s},f=async t=>{const e=await fetch("https://api.github.com/user",{headers:{Authorization:"token "+t}}),{login:s,name:i,email:a,avatar_url:n,html_url:r}=await e.json();return{login:s,name:i,email:a,avatar:n,url:r}},m=t=>{t?localStorage.submitToken=t:localStorage.removeItem("submitToken")},h=()=>localStorage.submitToken,{mapGetters:v,mapActions:b}=Object(r["a"])("login");var g={data(){return{running:[]}},mounted(){this.loadWorkspaceList(),o["b"].on("running",t=>{this.running=t}),this.fsLoaded||this.loadFs();const t=h();t&&this.updateToken(t)},computed:{...Object(r["d"])(["fsLoaded","workspaceList","diff","issues","issuesApply"]),...v(["currentState"])},methods:{...Object(r["c"])(["loadFs","loadWorkspaceList"]),...b(["updateToken"])}},_=g,y=(s("9620"),s("2877")),C=Object(y["a"])(_,a,n,!1,null,"411fe50c",null),k=C.exports,j=s("8c4f"),O=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container"},[e("list")],1)},w=[],x=function(){var t=this,e=t._self._c;return e("div",{ref:"container",staticClass:"index"},[e("div",{staticClass:"control search",class:{"is-loading":t.searching}},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.searchInput,expression:"searchInput"}],staticClass:"input",attrs:{type:"text",placeholder:"搜索"},domProps:{value:t.searchInput},on:{input:function(e){e.target.composing||(t.searchInput=e.target.value)}}})]),e("div",{ref:"bigDetector",staticClass:"indexContainer",style:{height:t.totalHeight+"px"}},t._l(t.renderedList,(function({i:t=0,file:s},i){return e("vtb",{key:"vtb_"+i,attrs:{i:t,file:s,n:i}})})),1),t.displayFileList.length?t._e():[e("br"),e("hr"),e("p",[t._v("无结果...")])]],2)},L=[],N=s("4c53"),S=s.n(N),I=s("f89f");Object(o["a"])(new S.a),Object.entries(I).map(([t,e])=>e.registerName(t));var A=function(){var t=this,e=t._self._c;return e("div",{staticClass:"vtb",style:{top:t.i*t.height+"px"},attrs:{n:t.n}},[e("br"),e("hr"),e("div",{staticClass:"columns is-mobile"},[e("div",{staticClass:"column name"},[e("h1",{staticClass:"title is-4 name"},[t._v(t._s(t.name))]),e("h2",{staticClass:"subtitle is-4 name"},[t._v(t._s(t.file))])]),e("div",{staticClass:"is-divider-vertical"}),e("div",{staticClass:"column"},[e("span",{staticClass:"tag is-light is-medium",class:{"is-link":"group"===t.type,"is-primary":"vtuber"===t.type}},[t._v(t._s(t.type))])]),e("div",{staticClass:"is-divider-vertical"}),e("div",{staticClass:"column"},[e("div",{staticClass:"buttons"},[e("router-link",{attrs:{to:"edit/"+t.file,custom:""},scopedSlots:t._u([{key:"default",fn:function({navigate:s}){return[e("button",{staticClass:"button is-info is-small",on:{click:s}},[t._v(" 编辑 ")])]}}])}),e("button",{staticClass:"button is-danger is-small",on:{click:t.remove}},[t._v("删除")])],1)])])])},$=[],M=s("faa1"),T=s.n(M);const E=110,F=new T.a,J=new Map,P=t=>{if(!J.has(t)){const e=new Promise(e=>F.once(t,e));J.set(t,e),e.then(()=>{J.delete(t)})}return J.get(t)};var W={props:["i","file","n"],data(){return{height:E,json:{},currentFile:void 0}},computed:{name(){return[...Object.values(this.json.name||{}),"loading..."].flat()[0]},type(){return this.json.type||"vtuber"}},methods:{...Object(r["c"])(["loadFileList"]),async remove(){await Object(I["deleteVtb"])(this.file),await this.loadFileList()}},watch:{file:{immediate:!0,async handler(t,e){if(t!==this.currentFile&&(this.json={}),await P(String(this.n)),t===this.file&&t&&t!==e){const e=await Object(I["getVtbJson"])(t);t===this.file&&(this.json=e,this.currentFile=t)}}}}},z=W,D=(s("23da"),Object(y["a"])(z,A,$,!1,null,"5d963466",null)),R=D.exports;const B=64;let G=0;const V=Array(1e3).fill().map((t,e)=>e/1e3);var U={data(){return{height:E,renderTop:0,renderedList:Array(B).fill({}),observer:void 0,bigObserver:void 0,searchInput:"",searchResult:void 0,searching:!1}},async mounted(){this.observer=new IntersectionObserver(t=>t.forEach(({isIntersecting:t,target:e})=>{if(t){const t=e.getAttribute("n");F.emit(t),G=Number(t)}}),{root:this.$refs.container,rootMargin:"80px 0px 20px 0px"}),this.bigObserver=new IntersectionObserver(t=>t.forEach(t=>{this.renderTop=Math.round(Math.max(0,t.intersectionRatio*this.displayFileList.length-B/2))}),{root:this.$refs.container,rootMargin:"9999999px 0px 0px 0px",threshold:V}),await this.loadFileList(),await this.$nextTick();const t=document.getElementsByClassName("vtb");Array(t.length).fill().map((e,s)=>t[s]).forEach(t=>this.observer.observe(t)),this.bigObserver.observe(this.$refs.bigDetector)},methods:{render(t,e){Array(e).fill().map((e,s)=>s+t).forEach(t=>{const e=t%B,s=this.displayFileList[t];this.renderedList[e]=s?{i:t,file:s}:{i:-10}}),this.renderedList=[...this.renderedList]},async search(t){const e=t.toLowerCase().split(" ").filter(Boolean);if(e.length){this.searching=!0;const s=await Object(I["searchList"])(e);t===this.searchInput&&(this.searchResult=s,this.searching=!1)}else this.searching=!1,this.searchResult=void 0},...Object(r["c"])(["loadFileList"])},watch:{async searchInput(t){this.search(t)},fileList(){this.searchInput&&this.search(this.searchInput)},async displayFileList(){this.render(this.renderTop,B),await this.$nextTick(),Array(15).fill(Math.max(0,G+B-9)).map((t,e)=>(e+t)%B).map(String).forEach(t=>F.emit(t))},renderTop(t,e){if(t>e){const s=Math.max(t,e+B),i=Math.min(t+B,this.displayFileList.length);if(s<i){const t=i-s;this.render(s,t)}}else if(e>t){const s=Math.min(e,t+B),i=s-t;this.render(t,i)}}},beforeDestroy(){this.observer.disconnect(),this.bigObserver.disconnect()},components:{vtb:R},computed:{...Object(r["d"])(["fileList"]),displayFileList(){return this.searchResult||this.fileList},totalHeight(){return this.displayFileList.length*this.height}}},H=U,Q=(s("625b"),Object(y["a"])(H,x,L,!1,null,"59e28c8c",null)),Z=Q.exports,q={components:{list:Z}},Y=q,K=Object(y["a"])(Y,O,w,!1,null,null,null),X=K.exports,tt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container"},[e("br"),e("diff",{attrs:{diff:t.diff}}),e("hr"),e("test",{attrs:{diff:t.diff}}),e("hr"),e("serialize",{attrs:{diff:t.diff,command:t.command}}),e("hr"),e("issue"),e("br")],1)},et=[],st=function(){var t=this,e=t._self._c;return e("div",[e("h1",{staticClass:"title"},[t._v("改变")]),e("h2",{staticClass:"subtitle"},[t._v("Difference ("+t._s(t.diff.length)+")")]),t._l(t.diff,(function([s,i]){return e("change",{key:"diff_"+s,attrs:{file:s,status:i,noReset:t.noReset,issue:t.issue}})}))],2)},it=[],at=function(){var t=this,e=t._self._c;return e("div",[e("p",{class:{"has-text-danger":"remove"===t.status,"has-text-success":"add"===t.status,"has-text-warning":"update"===t.status}},[t._v(t._s(t.file)+" "),t.noReset?t._e():e("button",{staticClass:"button is-small is-text",on:{click:t.reset}},[t._v("撤销")])])])},nt=[],rt={props:["status","file","noReset","issue"],methods:{...Object(r["c"])(["loadFileList"]),async reset(){await Object(I["resetVtb"])(this.file,this.issue),await this.loadFileList()}}},ot=rt,lt=(s("6299"),Object(y["a"])(ot,at,nt,!1,null,"79c0e39f",null)),ct=lt.exports,ut={props:["noReset","diff","issue"],components:{change:ct}},dt=ut,pt=Object(y["a"])(dt,st,it,!1,null,null,null),ft=pt.exports,mt=function(){var t=this,e=t._self._c;return e("div",[e("h1",{staticClass:"title"},[t._v("序列化")]),e("h2",{staticClass:"subtitle"},[t._v("Serialize")]),e("div",{staticClass:"table-container"},[e("table",{staticClass:"table is-striped is-hoverable is-fullwidth"},[e("thead",[e("tr",[e("th",[t._v("Command")]),e("th",[t._v("File")]),e("th",[t._v("content")]),t.issue?e("th",[t._v("before")]):t._e()])]),e("tbody",t._l(t.code,(function([s,i,a="",n=""]){return e("tr",{key:"s_"+i},[e("td",[t._v(t._s(s))]),e("td",[t._v(t._s(i))]),e("td",[a?e("code",{class:{green:t.issue}},[t._v(t._s(a))]):t._e()]),t.issue?e("td",[n?e("code",{staticClass:"red"},[t._v(t._s(n))]):t._e()]):t._e()])})),0)])])])},ht=[],vt={props:["diff","command","issue"],data(){return{code:[["loading..."]]}},watch:{async command(){this.code=await Object(I["serializeDiff"])(this.command,this.issue)},diff:{immediate:!0,async handler(){this.code=await Object(I["serializeDiff"])(this.command,this.issue)}}}},bt=vt,gt=(s("ba60"),Object(y["a"])(bt,mt,ht,!1,null,"17bbc46c",null)),_t=gt.exports,yt=function(){var t=this,e=t._self._c;return e("div",[e("h1",{staticClass:"title"},[t._v("发布")]),e("h2",{staticClass:"subtitle"},[t._v("Issue")]),t.diffLength&&t.diffLength>0?[e("input",{directives:[{name:"model",rawName:"v-model",value:t.inputTitle,expression:"inputTitle"}],staticClass:"input",attrs:{type:"text",placeholder:"标题: "+t.defaultTitle},domProps:{value:t.inputTitle},on:{input:function(e){e.target.composing||(t.inputTitle=e.target.value)}}}),e("br"),e("br"),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.input,expression:"input"}],staticClass:"textarea",attrs:{placeholder:"附加信息"},domProps:{value:t.input},on:{input:function(e){e.target.composing||(t.input=e.target.value)}}}),e("br"),e("code",[t._v(t._s(t.issue))]),e("br"),e("label",{staticClass:"checkbox"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.githubCommit,expression:"githubCommit"}],attrs:{type:"checkbox",disabled:!t.username},domProps:{checked:Array.isArray(t.githubCommit)?t._i(t.githubCommit,null)>-1:t.githubCommit},on:{change:function(e){var s=t.githubCommit,i=e.target,a=!!i.checked;if(Array.isArray(s)){var n=null,r=t._i(s,n);i.checked?r<0&&(t.githubCommit=s.concat([n])):r>-1&&(t.githubCommit=s.slice(0,r).concat(s.slice(r+1)))}else t.githubCommit=a}}}),t._v(" 以我的GitHub身份Commit "),t.username?t._e():[t._v("(登陆后可收到审核反馈邮件)")]],2),e("hr"),t.url?t._e():e("button",{staticClass:"button is-link is-light",class:{"is-loading":t.urlLoading},on:{click:t.submit}},[t._v("发布")]),e("br"),t.url?e("a",{attrs:{href:t.url,target:"_blank"}},[t._v(t._s(t.url))]):t._e(),e("br"),e("p",{staticClass:"warning"},[t._v("提交一次即可，vtbs.moe的数据会在人工审核通过后更新！")])]:t._e(),void 0===t.diffLength?e("span",[t._v(" loading... ")]):t._e(),0===t.diffLength?e("span",[t._v(" 无修改 ")]):t._e()],2)},Ct=[];s("14d9");const{mapState:kt,mapMutations:jt,mapGetters:Ot}=Object(r["a"])("login");var wt={data(){return{diffLength:void 0,input:"",issue:"",url:void 0,urlLoading:!1,inputTitle:""}},async mounted(){this.diffLength=(await Object(I["diff"])()).length+(await Object(I["getIssuesApply"])()).length},computed:{...Object(r["d"])(["diff","issuesApply"]),...kt(["commit","username","token","title"]),...Ot(["command"]),githubCommit:{get(){return this.username&&this.commit},set(t){this.setCommit(t)}},defaultTitle(){let t="";if(this.diff.length){const e=this.diff.map(([t,e])=>e),s=e.filter(t=>"remove"===t).length,i=e.filter(t=>"add"===t).length;t+=`${this.diff[0][0]} (${e.length}/-${s}/+${i})`}return this.issuesApply.length&&(t&&(t+=", "),t+="Merge "+this.issuesApply.length),t||"update"}},watch:{async diff(){this.diffLength=(await Object(I["diff"])()).length+(await Object(I["getIssuesApply"])()).length,await this.updateIssue()},command(){this.updateIssue()},input:{immediate:!0,handler(){this.updateIssue()}},inputTitle:{immediate:!0,handler(){this.inputTitle?this.setTitle(this.inputTitle):this.setTitle(this.defaultTitle)}}},methods:{...jt(["setCommit","setTitle"]),async submit(){this.urlLoading=!0;const t=[this.input,this.command];this.username&&t.push(this.token),this.url=await Object(I["submitDiff"])(...t)},async updateIssue(){const t=this.input,e=await Object(I["makeIssue"])(t,this.command);this.input===t&&(this.issue=e)}}},xt=wt,Lt=(s("faf5"),Object(y["a"])(xt,yt,Ct,!1,null,"15e8e73a",null)),Nt=Lt.exports,St=function(){var t=this,e=t._self._c;return e("div",[e("h1",{staticClass:"title"},[t._v("测试")]),t.loading?e("h2",{staticClass:"subtitle"},[t._v("少女祈祷中...")]):[e("h2",{staticClass:"subtitle"},[t._v("Error: "+t._s(t.errors.length))]),t._l(t.errors,(function(s,i){return e("p",{key:"error_"+i,staticClass:"has-text-danger"},[t._v(t._s(s))])}))]],2)},It=[],At={data(){return{errors:[],loading:!0}},watch:{async diff(){this.loading=!0,this.errors=await Object(I["test"])(this.issue),this.loading=!1}},async mounted(){this.errors=await Object(I["test"])(this.issue),this.loading=!1},props:["diff","issue"]},$t=At,Mt=Object(y["a"])($t,St,It,!1,null,null,null),Tt=Mt.exports;const{mapGetters:Et}=Object(r["a"])("login");var Ft={computed:{...Object(r["d"])(["diff"]),...Et(["command"])},components:{diff:ft,serialize:_t,issue:Nt,test:Tt}},Jt=Ft,Pt=Object(y["a"])(Jt,tt,et,!1,null,null,null),Wt=Pt.exports,zt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container"},[e("br"),e("div",{staticClass:"field is-horizontal"},[t._m(0),e("div",{staticClass:"field-body"},[e("div",{staticClass:"field has-addons"},[e("div",{staticClass:"control"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.editing.fileName,expression:"editing.fileName"}],staticClass:"input",attrs:{type:"text",placeholder:"文件名"},domProps:{value:t.editing.fileName},on:{input:function(e){e.target.composing||t.$set(t.editing,"fileName",e.target.value)}}})]),t._m(1),e("div",{staticClass:"control"},[t.msg.filename?e("p",{staticClass:"help warn is-danger"},[t._v(t._s(t.msg.filename))]):t._e()])])])]),e("hr"),t._l(t.editing.names,(function(s,i){return e("div",{key:"name_"+i,staticClass:"field is-horizontal"},[e("div",{staticClass:"field-label is-normal"},[i?t._e():e("label",{staticClass:"label"},[t._v("名字")]),i?t._e():e("p",{staticClass:"help"},[t._v("语言可以是 cn, en, jp 之类的")])]),e("div",{staticClass:"field-body"},[e("div",{staticClass:"field has-addons"},[e("div",{staticClass:"control"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.editing.names[i][0],expression:"editing.names[n][0]"}],staticClass:"input",attrs:{type:"text",placeholder:"语言"},domProps:{value:t.editing.names[i][0]},on:{input:function(e){e.target.composing||t.$set(t.editing.names[i],0,e.target.value)}}})]),e("div",{staticClass:"control"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.editing.names[i][1],expression:"editing.names[n][1]"}],staticClass:"input",attrs:{type:"text",placeholder:"名字"},domProps:{value:t.editing.names[i][1]},on:{input:function(e){e.target.composing||t.$set(t.editing.names[i],1,e.target.value)}}})]),e("div",{staticClass:"control"},[e("button",{staticClass:"button is-danger",on:{click:function(e){return t.deleteName(i)}}},[t._v("删除")])])])])])})),e("div",{staticClass:"field is-horizontal"},[e("div",{staticClass:"field-label"}),e("div",{staticClass:"field-body"},[e("button",{staticClass:"button is-link",on:{click:t.addName}},[t._v("添加名字")]),e("div",{staticClass:"control"},[t.msg.name?e("p",{staticClass:"help warn is-danger"},[t._v(t._s(t.msg.name))]):t._e()])])]),e("hr"),e("div",{staticClass:"field is-horizontal"},[e("div",{staticClass:"field-label is-normal"},[e("label",{staticClass:"label"},[t._v("记录类型")]),"group"===t.editing.type?e("p",{staticClass:"help"},[t._v("请为每个社团成员创建单独的文件，不要把成员的账号放进社团的文件")]):t._e()]),e("div",{staticClass:"field-body"},[e("div",{staticClass:"field"},[e("div",{staticClass:"select"},[e("select",{directives:[{name:"model",rawName:"v-model",value:t.editing.type,expression:"editing.type"}],on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.editing,"type",e.target.multiple?s:s[0])}}},[e("option",{attrs:{value:"vtuber"}},[t._v("虚拟主播")]),e("option",{attrs:{value:"group"}},[t._v("社团")])])])])])]),e("div",{staticClass:"field is-horizontal"},[t._m(2),e("div",{staticClass:"field-body"},[e("div",{staticClass:"field"},[e("label",{staticClass:"checkbox"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.editing.bot,expression:"editing.bot"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.editing.bot)?t._i(t.editing.bot,null)>-1:t.editing.bot},on:{change:function(e){var s=t.editing.bot,i=e.target,a=!!i.checked;if(Array.isArray(s)){var n=null,r=t._i(s,n);i.checked?r<0&&t.$set(t.editing,"bot",s.concat([n])):r>-1&&t.$set(t.editing,"bot",s.slice(0,r).concat(s.slice(r+1)))}else t.$set(t.editing,"bot",a)}}}),t._v(" 机器人 ")])])])]),e("hr"),t._l(t.editing.accounts,(function({id:s},i){return e("div",{key:"account_"+i,staticClass:"field is-horizontal"},[e("div",{staticClass:"field-label is-normal"},[i?t._e():e("label",{staticClass:"label"},[t._v("账号")]),s&&t.urls[i].startsWith("http")?e("a",{staticClass:"help url",attrs:{href:t.urls[i],target:"_blank"}},[t._v(t._s(t.urls[i]))]):e("p",{staticClass:"help url"},[t._v(t._s(t.urls[i]))])]),e("div",{staticClass:"field-body"},[e("div",{staticClass:"field has-addons"},[e("div",{staticClass:"control"},[e("div",{staticClass:"select"},[e("select",{directives:[{name:"model",rawName:"v-model",value:t.editing.accounts[i].platform,expression:"editing.accounts[n].platform"}],on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.editing.accounts[i],"platform",e.target.multiple?s:s[0])}}},[t._l(t.platforms,(function([s]){return e("option",{key:`account_${i}_${s}`,domProps:{value:s}},[t._v(t._s(s))])})),e("option",{attrs:{value:"other"}},[t._v("其他")])],2)])]),e("div",{staticClass:"control"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.editing.accounts[i].id,expression:"editing.accounts[n].id"}],staticClass:"input",attrs:{type:"text",placeholder:"{id}"},domProps:{value:t.editing.accounts[i].id},on:{input:function(e){e.target.composing||t.$set(t.editing.accounts[i],"id",e.target.value)}}})]),e("div",{staticClass:"control"},[e("button",{staticClass:"button is-danger",on:{click:function(e){return t.deleteAccount(i)}}},[t._v("删除")])])])])])})),e("div",{staticClass:"field is-horizontal"},[e("div",{staticClass:"field-label"}),e("div",{staticClass:"field-body"},[e("button",{staticClass:"button is-link",on:{click:t.addAccount}},[t._v("添加账号")])])]),e("hr"),e("div",{staticClass:"field is-horizontal"},[e("div",{staticClass:"field-label is-normal"},[t.saved?e("p",{staticClass:"help"},[t._v("保存成功!")]):t._e(),t.failed?e("p",{staticClass:"help is-danger"},[t._v("格式错误，请检查上面的输入!")]):t._e()]),e("div",{staticClass:"field-body"},[e("div",{staticClass:"field is-grouped"},[e("div",{staticClass:"control"},[e("button",{staticClass:"button is-link",class:{"is-loading":t.saving},attrs:{disabled:!t.editing.fileName||t.saving},on:{click:t.save}},[t._v("保存 "+t._s(t.fileName))])]),e("div",{staticClass:"control"},[e("button",{staticClass:"button is-link is-light",on:{click:t.reset}},[t._v("复原")])]),e("div",{staticClass:"control"},[e("router-link",{attrs:{to:"/",custom:""},scopedSlots:t._u([{key:"default",fn:function({navigate:s}){return[e("button",{staticClass:"button is-light",on:{click:s}},[t._v(" 返回 ")])]}}])})],1),e("div",{staticClass:"control"},[e("button",{staticClass:"button is-danger",attrs:{disabled:!t.file},on:{click:t.remove}},[t._v("删除")])])])])]),e("hr"),e("div",{staticClass:"field is-horizontal"},[t._m(3),e("div",{staticClass:"field-body"},[e("div",{staticClass:"field"},[e("div",{staticClass:"control"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.editing.group,expression:"editing.group"}],staticClass:"input",attrs:{type:"text",placeholder:"社团"},domProps:{value:t.editing.group},on:{input:function(e){e.target.composing||t.$set(t.editing,"group",e.target.value)}}})]),t._l(t.groupAuto,(function(s){return e("button",{key:"groupAuto_"+s,staticClass:"button is-text",on:{click:function(e){t.editing.group=s}}},[t._v(t._s(s))])}))],2)])]),e("hr"),e("code",[t._v(t._s(t.code))]),e("br")],2)},Dt=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"field-label is-normal"},[e("label",{staticClass:"label"},[t._v("文件名")]),e("p",{staticClass:"help"},[t._v("一般用名字")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"control"},[e("a",{staticClass:"button is-static"},[t._v(".json")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"field-label is-normal"},[e("label",{staticClass:"label"},[t._v("是不是机器人")]),e("p",{staticClass:"help"},[t._v("就是24*7那样的")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"field-label is-normal"},[e("label",{staticClass:"label"},[t._v("所属社团")]),e("p",{staticClass:"help"},[t._v("这里写所属社团记录的文件名"),e("br"),t._v("(不需要文件后缀)")]),e("p",{staticClass:"help"},[t._v("无所属留空")])])}],Rt={props:["file"],data(){const t={fileName:"",names:[],type:"vtuber",bot:!1,accounts:[],group:""};return this.msg={},this.backup=JSON.stringify(t),this.blank=JSON.stringify(t),{editing:t,saving:!1,saved:!1,saveReset:!0,failed:!1,rest:{},groupList:[]}},watch:{editing:{deep:!0,handler(){this.saveReset?this.saved=!1:this.saveReset=!0,this.failed=!1}},"editing.fileName":{handler(){this.checkFileName()}},"editing.names":{deep:!0,handler(){this.checkName()}},file:{immediate:!0,async handler(t,e){if(t!==e)if(t){const{accounts:e={},name:s={},type:i,bot:a,group:n,...r}=await Object(I["getVtbJson"])(t);this.saveReset=!1,this.editing=JSON.parse(this.blank),this.editing.fileName=t.replace(".json",""),Object.entries(s).flatMap(([t,e])=>[e].flat().map(e=>[t,e])).forEach(([t,e])=>this.editing.names.push([t,e])),Object.entries(e).flatMap(([t,e])=>[e].flat().map(e=>[t,e])).map(([t,e])=>[t,e.id||e]).forEach(([t,e])=>this.editing.accounts.push({platform:t,id:e})),i&&(this.editing.type=i),a&&(this.editing.bot=a),n&&(this.editing.group=n),this.backup=JSON.stringify(this.editing),this.rest=r}else this.backup=this.blank,this.rest={},this.reset();this.groupList=await Object(I["getGroupList"])()}}},async mounted(){},methods:{...Object(r["c"])(["loadFileList"]),addName(){this.editing.names.push(["",""])},deleteName(t){this.editing.names.splice(t,1)},addAccount(){this.editing.accounts.push({id:"",platform:"bilibili"})},deleteAccount(t){this.editing.accounts.splice(t,1)},checkFileName(){return this.msg.filename='\\/:*"<>|'.split("").some(t=>this.editing.fileName.includes(t))?"非法文件名":void 0,!this.msg.filename},checkName(){if(0===this.editing.names.length)return this.msg.name="未填写名称",!1;for(const t of this.editing.names){if(!t[0])return this.msg.name="未填写语言",!1;if(" ,:*\\/".split("").some(e=>t[0].includes(e)))return this.msg.name="名称语言无效",!1}return this.msg.name=void 0,!0},async remove(){await Object(I["deleteVtb"])(this.file),this.$router.push("/")},async save(){this.saving=!0,this.checkFileName()&&this.checkName()?(this.file&&await Object(I["deleteVtb"])(this.file),await Object(I["saveVtb"])(this.fileName,this.data),this.saving=!1,this.saved=!0,await this.loadFileList(),this.file!==this.fileName&&this.$router.push("/edit/"+this.fileName)):(this.saving=!1,this.failed=!0)},reset(){this.editing=JSON.parse(this.backup)}},computed:{...Object(r["d"])(["meta"]),groupAuto(){const t=this.editing.group,e=t.toLowerCase().split(" ").filter(Boolean),s=this.groupList.filter(t=>e.every(e=>t.toLowerCase().includes(e)));return 1===s.length&&s[0]===t?[]:s},platforms(){return Object.entries(this.meta.linkSyntax)},linkSyntax(){return{...this.meta.linkSyntax,other:"请直接输入完整链接"}},urls(){return this.editing.accounts.map(({platform:t,id:e})=>({platform:t,id:e||"{id}"})).map(({platform:t,id:e})=>this.linkSyntax[t].replace("{id}",e))},fileName(){return this.editing.fileName+".json"},code(){return JSON.stringify(this.data,void 0,2)},data(){const t={},{accounts:e,group:s,names:i,type:a,bot:n}=this.editing;return i.length&&(t.name={},i.forEach(([e,s])=>{t.name[e]?t.name[e]=[t.name[e],s].flat():t.name[e]=s})),e.length&&(t.accounts={},e.forEach(({id:e,platform:s})=>{t.accounts[s]?t.accounts[s]=[t.accounts[s],e].flat():t.accounts[s]=e})),"vtuber"!==a&&(t.type=a),n&&(t.bot=!0),s&&(t.group=s,t.group.endsWith(".json")&&(t.group=t.group.replace(".json",""))),{...this.rest,...t}}}},Bt=Rt,Gt=(s("197f"),Object(y["a"])(Bt,zt,Dt,!1,null,"0644c0a8",null)),Vt=Gt.exports,Ut=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container high"},[e("br"),e("h1",{staticClass:"title"},[t._v("存档")]),e("h2",{staticClass:"subtitle"},[t._v("Workspace ("+t._s(t.workspaceCount)+")")]),e("hr"),e("div",{staticClass:"field has-addons"},[e("div",{staticClass:"control"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.name,expression:"name"}],staticClass:"input",attrs:{type:"text",placeholder:"名字"},domProps:{value:t.name},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.save.apply(null,arguments)},input:function(e){e.target.composing||(t.name=e.target.value)}}})]),e("div",{staticClass:"control"},[e("button",{staticClass:"button is-info",on:{click:t.save}},[t._v("保存")])])]),e("hr"),t._l(t.workspaceList,(function(s){return e("div",{key:"save_"+s,staticClass:"field is-horizontal"},[e("div",{staticClass:"field-label is-normal"},[e("label",{staticClass:"label"},[t._v(t._s(s))])]),e("div",{staticClass:"field-body"},[e("div",{staticClass:"field is-grouped"},[e("div",{staticClass:"control"},[e("button",{staticClass:"button is-info",on:{click:function(e){return t.load(s)}}},[t._v("载入")])]),e("div",{staticClass:"control"},[e("button",{staticClass:"button is-light is-danger",on:{click:function(e){return t.remove(s)}}},[t._v(" 删除")])])])])])})),e("br")],2)},Ht=[],Qt={data(){return{workspaceListLoaded:!1,name:""}},async mounted(){await this.loadWorkspaceList(),this.workspaceListLoaded=!0},computed:{workspaceCount(){return this.workspaceListLoaded?this.workspaceList.length:"loading..."},...Object(r["d"])(["workspaceList"])},methods:{...Object(r["c"])(["loadFileList","loadWorkspaceList"]),async save(){const t=this.name;t&&(await Object(I["saveWorkspace"])(t),await this.loadWorkspaceList())},async load(t){await Object(I["loadWorkspace"])(t),await this.loadFileList()},async remove(t){await Object(I["deleteWorkspace"])(t),await this.loadWorkspaceList()}}},Zt=Qt,qt=(s("5598"),Object(y["a"])(Zt,Ut,Ht,!1,null,"7f50a6a6",null)),Yt=qt.exports,Kt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container"},[e("div",{staticClass:"content"},[e("br"),t.username?e("status"):t.code||t.token?e("codee",{attrs:{code:t.code}}):e("login")],1)])},Xt=[],te=function(){var t=this,e=t._self._c;return e("div",[e("h3",[t._v("GitHub账号")]),e("img",{attrs:{src:t.extra.avatar,alt:"avatar",height:"128px",width:"128px"}}),e("p",[t._v("用户名: "+t._s(t.username)+" "),e("a",{attrs:{href:t.extra.url,target:"_blank"}},[t._v(t._s(t.extra.url))]),t._v(" "),e("br"),t._v(" 昵称: "+t._s(t.name)+" "),e("br"),t._v(" 邮箱: "+t._s(t.email))]),e("button",{staticClass:"button",on:{click:t.logout}},[t._v("登出")]),e("br")])},ee=[];const{mapState:se,mapActions:ie}=Object(r["a"])("login");var ae={computed:se(["username","name","email","extra"]),methods:{...ie(["updateToken"]),logout(){this.updateToken()}}},ne=ae,re=Object(y["a"])(ne,te,ee,!1,null,null,null),oe=re.exports,le=function(){var t=this,e=t._self._c;return e("div",[t.fail||t.failed?e("p",[t._v("呜呜呜...登陆失败, 再试试吧QAQ")]):e("p",[t._v("登陆中...")]),t.fail||t.failed?e("login"):t._e()],1)},ce=[],ue=function(){var t=this,e=t._self._c;return e("div",[e("h3",[t._v("登陆GitHub")]),e("h5",{staticClass:"subtitle"},[t._v("不登陆也可以用的哦")]),e("a",{attrs:{href:t.url}},[t._v("通过GitHub登陆")])])},de=[],pe={data(){return{url:d()}}},fe=pe,me=Object(y["a"])(fe,ue,de,!1,null,null,null),he=me.exports;const{mapActions:ve,mapState:be}=Object(r["a"])("login");var ge={props:["code"],components:{login:he},data(){return{fail:!1}},computed:be({failed:"fail"}),async mounted(){if(this.code){const t=await p(this.code).catch(()=>{});t?await this.updateToken(t):this.fail=!0}},methods:ve(["updateToken"])},_e=ge,ye=Object(y["a"])(_e,le,ce,!1,null,null,null),Ce=ye.exports;const{mapState:ke}=Object(r["a"])("login");var je={props:["code"],components:{login:he,codee:Ce,status:oe},computed:ke(["username","token"])},Oe=je,we=Object(y["a"])(Oe,Kt,Xt,!1,null,null,null),xe=we.exports,Le=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container"},[e("div",{staticClass:"flex-container"},t._l(t.issueCompute,(function(s){return e("router-link",{key:s.key,attrs:{to:"/issue/"+s.key,custom:""},scopedSlots:t._u([{key:"default",fn:function({navigate:i}){return[e("div",{staticClass:"boxx",on:{click:i}},[e("h1",{staticClass:"title"},[t._v(t._s(s.title))]),e("h2",{staticClass:"subtitle"},[t._v(t._s(s.key))]),s.apply?e("button",{staticClass:"delete is-large",on:{click:function(e){return e.preventDefault(),t.unapplyIssue(s.key)}}}):e("button",{staticClass:"button is-success",on:{click:function(e){return e.preventDefault(),t.applyIssue(s.key)}}},[t._v("Load")])])]}}],null,!0)})})),1)])},Ne=[],Se={computed:{...Object(r["d"])(["issues","issuesApply"]),issueCompute(){return Object.entries(this.issues).map(([t,e])=>{const s=this.issuesApply.includes(t),i=(e.commands.filter(([t])=>"title"===t)[0]||[void 0,"update"])[1];return{key:t,apply:s,title:i}})}},methods:Object(r["c"])(["applyIssue","unapplyIssue"])},Ie=Se,Ae=(s("db66"),Object(y["a"])(Ie,Le,Ne,!1,null,"d28e94da",null)),$e=Ae.exports,Me=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container"},[e("div",{staticClass:"boxx"},[e("h1",{staticClass:"title"},[t._v(t._s(t.title))]),e("p",[t.apply?e("button",{staticClass:"delete is-large",on:{click:function(e){return e.preventDefault(),t.unapplyIssue(t.id)}}}):e("button",{staticClass:"button is-success",on:{click:function(e){return e.preventDefault(),t.applyIssue(t.id)}}},[t._v("Load")]),e("br"),t._v(" issue "),e("a",{attrs:{href:t.issueLink,target:"_blank",rel:"noopener noreferrer"}},[t._v(t._s(t.issueLink))]),e("br"),t._v(" diff "),e("a",{attrs:{href:t.diffLink,target:"_blank",rel:"noopener noreferrer"}},[t._v(t._s(t.diffLink))])]),e("hr"),e("diff",{attrs:{diff:t.diff,noReset:!t.apply,issue:t.id}}),e("hr"),e("test",{attrs:{diff:t.diff,issue:t.id}}),e("hr"),e("serialize",{attrs:{diff:t.diff,command:t.currentIssue.commands,issue:t.id}}),e("hr"),e("code",[t._v(" "+t._s(t.currentIssue.issue.body)+" ")])],1)])},Te=[],Ee={props:["id"],data:()=>({diff:[]}),async created(){this.diff=await Object(I["diff"])(this.id)},computed:{...Object(r["d"])(["issues","issuesApply"]),currentIssue(){return this.issues[this.id]},issueLink(){return"http://github.com/dd-center/vdb/issues/"+this.currentIssue.issue.number},diffLink(){return"https://github.com/dd-center/vdb/compare/master...submit-"+this.currentIssue.issue.number},title(){return(this.currentIssue.commands.filter(([t])=>"title"===t)[0]||[void 0,"update"])[1]},apply(){return this.issuesApply.includes(this.id)}},methods:Object(r["c"])(["applyIssue","unapplyIssue"]),components:{diff:ft,serialize:_t,test:Tt}},Fe=Ee,Je=(s("a6f5"),Object(y["a"])(Fe,Me,Te,!1,null,"0a852680",null)),Pe=Je.exports;i["a"].use(j["a"]);const We=[{path:"/",component:X},{path:"/submit",component:Wt},{path:"/edit",component:Vt},{path:"/edit/:file",component:Vt,props:!0},{path:"/workspace",component:Yt},{path:"/issue",component:$e},{path:"/issue/:id",component:Pe,props:!0},{path:"/login",component:xe,props:t=>({code:t.query.code})}],ze=new j["a"]({mode:"history",base:"/",routes:We});var De=ze;i["a"].use(r["b"]);const Re={namespaced:!0,state:{username:void 0,name:void 0,token:void 0,email:void 0,fail:!1,extra:{},title:"",commit:!0},getters:{currentState:t=>t.username?`(${t.name||t.username})`:t.fail?"(登陆失败)":t.token?"(登陆中)":"",command:t=>{const e=[];return t.commit&&t.username&&(e.push(["name",t.name||t.username]),t.email&&e.push(["email",t.email])),t.title&&e.push(["title",t.title]),e}},mutations:{setToken:(t,e)=>{t.token=e,m(e)},fail:t=>{t.fail=!0},setUsername:(t,e)=>{t.username=e},setName:(t,e)=>{t.name=e},setEmail:(t,e)=>{t.email=e},setExtra:(t,e={})=>{t.extra=e},setTitle(t,e){t.title=e},setCommit:(t,e)=>{t.commit=e}},actions:{updateToken:async({commit:t},e)=>{if(t("setToken",e),e){const{login:s,name:i,email:a,avatar:n,url:r}=await f(e).catch(()=>({}));s?(t("setUsername",s),t("setExtra",{avatar:n,url:r}),i&&t("setName",i),a&&t("setEmail",a)):t("fail")}else t("setUsername"),t("setExtra"),t("setName"),t("setEmail")}}};var Be=new r["b"].Store({state:{fileList:[],fsLoaded:!1,meta:{},diff:[],workspaceList:[],issues:{},issuesApply:[]},mutations:{loadedFs(t){t.fsLoaded=!0},updateFileList(t,e){t.fileList=e},updateMeta(t,e){t.meta=e},updateDiff(t,e){t.diff=e},updateWorkspaceList(t,e){t.workspaceList=e},updateIssues(t,e){t.issues=e},updateIssuesApply(t,e){t.issuesApply=e}},actions:{async loadFileList({commit:t,dispatch:e}){const s=await Object(I["getList"])();t("updateFileList",s),await e("loadDiff")},async loadFs({commit:t,dispatch:e}){await Object(I["loadFs"])(),t("updateMeta",await Object(I["getMeta"])()),await e("loadIssues"),t("loadedFs")},async loadDiff({commit:t}){t("updateDiff",await Object(I["diff"])())},async loadWorkspaceList({commit:t}){t("updateWorkspaceList",await Object(I["loadWorkspaceList"])())},async loadIssues({commit:t}){t("updateIssues",await Object(I["getIssues"])()),t("updateIssuesApply",await Object(I["getIssuesApply"])())},async applyIssue({dispatch:t},e){await Object(I["applyIssue"])(e),await t("loadIssues"),await t("loadDiff")},async unapplyIssue({dispatch:t},e){await Object(I["unapplyIssue"])(e),await t("loadIssues"),await t("loadDiff")}},modules:{login:Re}});s("e0d3");i["a"].config.productionTip=!1,new i["a"]({router:De,store:Be,render:t=>t(k)}).$mount("#app")},"59a1":function(t,e,s){},"625b":function(t,e,s){"use strict";s("f342")},6299:function(t,e,s){"use strict";s("c5cf")},6691:function(t,e){t.exports=(t,e)=>e.map(t=>t.split("").reverse().join("").replace("nosj.","").split("").reverse().join("")).filter(t=>t.endsWith(" ")||t.startsWith(" ")).map(t=>`文件名 开头/结尾 存在空格: ${t}.json`)},"8a49":function(t,e,s){s("14d9");const{v5:i}=s("e144");t.exports=({vtbs:t,linkSyntax:e,UUID_NAMESPACE:s},a=!1)=>({meta:{UUID_NAMESPACE:s,linkSyntax:e},vtbs:t.map(({name:t,object:e})=>({uuid:i(t,s),object:e,name:t})).map(({object:t,...e})=>({object:{...t,name:Object.entries(t.name||{})},...e})).map(({object:t,...e})=>({object:{...t,accounts:Object.entries(t.accounts||{})},...e})).map(({uuid:t,object:e,name:n})=>{const r={uuid:t};return r.type=e.type||"vtuber",r.bot=!!e.bot,r.accounts=e.accounts.map(([t,e])=>[t,[e].flat()]).flatMap(([t,e])=>e.map(e=>({platform:t,id:e}))).map(({platform:t,id:e})=>"string"===typeof e?{platform:t,id:{id:e}}:{platform:t,id:e}).map(({platform:t,id:e})=>({...e,type:e.type||"official",platform:t})),r.name={extra:[]},e.name.map(([t,e])=>"object"===typeof e?[t,e]:[t,[e]]).forEach(([t,e])=>e.forEach(e=>{r.name[t]?r.name.extra.push(e):r.name[t]=e})),!r.name.default&&(e.name[0]||[void 0])[0]&&(r.name.default=(e.name[0]||[void 0])[0]),e.group?(r.group=i(e.group,s),r.group_name=e.group):"group"===r.type&&(r.group=t),a&&(r.filename=n),r})})},9309:function(t,e,s){s("14d9");const i={};t.exports=({vtbs:t})=>{const e=[],s={},a=({platform:t,id:s,name:i})=>a=>e.push(`${Object.values(i)[1]}, ${a}: ${t}, ${s}`);return t.forEach(({accounts:t,name:e})=>t.forEach(({id:t,platform:n,type:r})=>{const o=a({name:e,id:t,platform:n});t||o("id为空"),s[n]||(s[n]={}),s[n][t]&&o("重复提交的账户, Duplicated"),s[n][t]=!0;const l=i[n]||[];l.includes(t)&&o("不能提交的账户, Never Submit")})),e}},9620:function(t,e,s){"use strict";s("fabb")},"9d6a":function(t,e){t.exports=({vtbs:t})=>t.filter(({name:{default:t}})=>!t).map(({filename:t})=>`name不对: ${t}.json`)},a6f5:function(t,e,s){"use strict";s("59a1")},b74b:function(t,e){const s='\\/:*"<>|'.split("");t.exports=(t,e)=>e.filter(t=>s.some(e=>t.includes(e))).map(t=>`非法文件名, illegal filename: ${t}, should not contain ${s.join("")}`)},b90b:function(t,e){t.exports=({vtbs:t,meta:{linkSyntax:e}})=>t.flatMap(({accounts:t})=>t).map(({id:t,platform:s})=>{if(!e[s])return`不明平台, unknow platform, ${s}, ${t}`}).filter(Boolean)},ba60:function(t,e,s){"use strict";s("0e2e")},bacb:function(t,e,s){},c5cf:function(t,e,s){},c754:function(t,e){t.exports=({vtbs:t})=>t.flatMap(({accounts:t})=>t).map(({id:t,platform:e})=>{if(["bilibili","niconico","weibo","163music"].includes(e)&&Number.isNaN(Number(t)))return`${e} id: NaN, ${t}`}).filter(Boolean)},cb76:function(t,e){t.exports=(t,e)=>e.filter(t=>!t.endsWith(".json")).map(t=>"只接受 json 文件, Only json: "+t)},db66:function(t,e,s){"use strict";s("bacb")},e0d3:function(t,e,s){},ed54:function(t,e,s){},f342:function(t,e,s){},f4ec:function(t,e,s){},f89f:function(t,e,s){"use strict";s.r(e),function(t){s.d(e,"loadFs",(function(){return g})),s.d(e,"loadWorkspaceList",(function(){return _})),s.d(e,"saveWorkspace",(function(){return y})),s.d(e,"loadWorkspace",(function(){return C})),s.d(e,"deleteWorkspace",(function(){return k})),s.d(e,"getIssues",(function(){return j})),s.d(e,"getIssuesApply",(function(){return O})),s.d(e,"applyIssue",(function(){return L})),s.d(e,"unapplyIssue",(function(){return N})),s.d(e,"getMeta",(function(){return S})),s.d(e,"getFs",(function(){return I})),s.d(e,"getList",(function(){return A})),s.d(e,"getGroupList",(function(){return $})),s.d(e,"searchList",(function(){return M})),s.d(e,"getVtbJson",(function(){return T})),s.d(e,"deleteVtb",(function(){return E})),s.d(e,"saveVtb",(function(){return F})),s.d(e,"resetVtb",(function(){return J})),s.d(e,"test",(function(){return W})),s.d(e,"diff",(function(){return D})),s.d(e,"serializeDiff",(function(){return U})),s.d(e,"makeIssue",(function(){return Q})),s.d(e,"submitDiff",(function(){return Z}));s("14d9");var i=s("cf59"),a=s("0640"),n=s("8a49"),r=s.n(n),o=s("3e55"),l=s.n(o);const c=new i["Level"]("submit.vtbs.moe-workspace");let u,d,p,f={},m=[];const h=new WeakMap,v=e=>t.from(e).toString("base64"),b=async t=>(await fetch(t,{cache:"no-cache"})).json(),g=Object(a["c"])(async()=>{d=await b("https://vdb.vtbs.moe/json/fs.json"),p||(p=JSON.parse(JSON.stringify(d))),u=await b("https://vdb.vtbs.moe/json/list.json"),f=await b("https://vdb.vtbs.moe/json/fs-review.json")}),_=Object(a["c"])(async()=>{const t=[];for await(const e of c.keys())t.push(e);return t}),y=Object(a["c"])(async t=>{await c.put(t,JSON.stringify(p))}),C=Object(a["c"])(async t=>{p=JSON.parse(await c.get(t))}),k=Object(a["c"])(async t=>{await c.del(t)}),j=Object(a["c"])(()=>f),O=Object(a["c"])(()=>m),w=(t,e)=>e.reduce((t,[e,s,i])=>{if("delete"===e){const{[s]:e,...i}=t;return i}return"put"===e?{...t,[s]:JSON.parse(i)}:t},t),x=()=>{if(!h.has(m)){const t=w(JSON.parse(JSON.stringify(d)),m.map(t=>f[t]).flatMap(({commands:t})=>t));h.set(m,t)}return h.get(m)},L=Object(a["c"])(t=>{m.includes(t)||(m=[...m,t],p=w(p,f[t].commands))}),N=Object(a["c"])(t=>{const e=V();m=m.filter(e=>e!==t),p=w(x(),e)}),S=Object(a["c"])(()=>u.meta),I=Object(a["c"])(()=>p),A=Object(a["c"])(()=>Object.keys(p).reverse()),$=Object(a["c"])(()=>Object.entries(p).map(([t,{type:e}])=>({file:t,type:e})).filter(({type:t})=>"group"===t).map(({file:t})=>t.replace(".json",""))),M=Object(a["c"])(t=>Object.entries(p).map(([t,e])=>[t.toLowerCase(),JSON.stringify(e).toLowerCase(),t]).filter(([e,s])=>t.every(t=>e.includes(t)||s.includes(t))).map(([t,e,s])=>s)),T=Object(a["c"])(t=>p[t]),E=Object(a["c"])(t=>{delete p[t]}),F=Object(a["c"])((t,e)=>{const s=t.toLowerCase(),i=Object.keys(p).find(t=>t.toLowerCase()===s);i&&E(i),p[t]=e}),J=Object(a["c"])((t,e)=>{const s=e?d:x();s[t]?F(t,JSON.parse(JSON.stringify(s[t]))):E(t)}),P=t=>r()({...u.meta,vtbs:Object.entries(t).map(([t,e])=>[t.replace(".json",""),e]).map(([t,e])=>({name:t,object:e}))},!0),W=Object(a["c"])(t=>{const e=t?w(JSON.parse(JSON.stringify(d)),f[t].commands):p;return l()(P(e),Object.keys(e))}),z=(t,e,s)=>s[t]?e[t]?JSON.stringify(e[t])!==JSON.stringify(s[t])?"update":void 0:"add":"remove",D=Object(a["c"])(t=>{const e=t?d:x(),s=t?w(JSON.parse(JSON.stringify(d)),f[t].commands):p;return[...new Set([...Object.keys(e),...Object.keys(s)])].map(t=>[t,z(t,e,s)]).filter(([t,e])=>e)}),R=t=>{const{accounts:e={}}=p[t],{linkSyntax:s}=S();return Object.entries(e).map(([t,e])=>[s[t],e]).map(t=>t.flat()).map(([t,...e])=>[t,...e.map(t=>t.id||t)]).flatMap(([t="{id}",...e])=>e.map(e=>t.replace("{id}",e)))},B=()=>{const t=D();return t.map(([t,e])=>{if("add"===e||"update"===e){const s=R(t).map(t=>t.startsWith("http")?`<${t}>`:t).map(t=>"> "+t).join("\n");if(s.length)return[t,e,`\n${s}\n`]}return[t,e]}).map(([t,e,s=""])=>`${e}: ${t}${s}`).sort().join("\n")},G=()=>{const t=m.map(t=>f[t].issue.number).map(t=>"#"+t);return t.length?"\nMerge: "+t.join(" "):""},V=()=>D().map(([t,e])=>{switch(e){case"remove":return["delete",t];case"add":case"update":return["put",t,JSON.stringify(T(t),void 0,2)];default:}}).filter(Boolean),U=Object(a["c"])((t=[],e)=>{if(e)return f[e].commands.map(([t,e,s])=>[t,e,s,d[e]&&JSON.stringify(d[e],void 0,2)]);const s=m.map(t=>f[t].issue.number).map(t=>["merge",t]),i=[...s,...V()];return i.length?[...t,...i]:[]}),H=t=>{const e=U(t);return v(e.map(([t,e,s])=>{const i=[t,v(e)];return s&&i.push(v(s)),i}).map(t=>t.join(":")).join("\n"))},Q=Object(a["c"])((t,e)=>{const s=H(e),i=B(),a=G();return`${t}\n\n### description\n${a}\n${i}\n\n\`\`\`\n-----BEGIN SUBMIT BLOCK-----${s}-----END SUBMIT BLOCK-----\n\`\`\`\n\nSubmit from <https://submit.vtbs.moe>, please evaluate the automatic Pull Request`}),Z=Object(a["c"])(async(t,e,s)=>{const i=Q(t,e),a=s?"token "+s:"Basic ZGQtY2VudGVyLWJvdDpkZDBiMmY0MjE4OThmNjAzZGYwNGM0NzdkMzQyNmU5MzE4MWRlZTUy",n=await fetch("https://api.github.com/repos/dd-center/vdb/issues",{method:"POST",headers:{"Content-Type":"application/json",Authorization:a},body:JSON.stringify({title:"Change requested from submit.vtbs.moe",body:i})}),{html_url:r}=await n.json();return r})}.call(this,s("1c35").Buffer)},fabb:function(t,e,s){},faf5:function(t,e,s){"use strict";s("51c0")},fd73:function(t,e,s){}});
//# sourceMappingURL=app.113f0e32.js.map